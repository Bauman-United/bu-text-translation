"""
OpenAI GPT service for generating sports commentary.

This module provides functionality to generate dynamic sports commentary
using OpenAI's GPT models for the Bauman United football team.
"""

import logging
from typing import List, Optional
from openai import OpenAI
from config.settings import Config

logger = logging.getLogger(__name__)


class GPTCommentaryService:
    """Service for generating sports commentary using OpenAI GPT."""
    
    def __init__(self):
        """Initialize the GPT service."""
        self.config = Config()
        if not self.config.is_openai_configured:
            raise ValueError("OpenAI API key not configured")
        
        self.client = OpenAI(api_key=self.config.OPENAI_KEY)
        self.model = "gpt-4"  # Using GPT-4 for better quality
    
    def generate_commentary(
        self, 
        previous_messages: List[str], 
        new_score: str, 
        is_our_goal: bool = True,
        scorer_surname: str = None
    ) -> Optional[str]:
        """
        Generate sports commentary for a score change.
        
        Args:
            previous_messages: List of previous score change messages
            new_score: New score in format "2:1" or "1-1"
            is_our_goal: Whether our team scored (True) or opponent scored (False)
            scorer_surname: Surname of the player who scored (if our team scored)
            
        Returns:
            Generated commentary message or None if generation failed
        """
        try:
            # Format previous messages for context
            context_messages = "\n".join([f'"{msg}"' for msg in previous_messages])
            
            # Format scorer information
            scorer_info = scorer_surname if scorer_surname else "Ð¿ÑƒÑÑ‚Ð¾Ð¹"
            
            # Create the prompt
            prompt = f"""Ð¢Ñ‹ â€” Ñ„ÑƒÑ‚Ð±Ð¾Ð»ÑŒÐ½Ñ‹Ð¹ ÐºÐ¾Ð¼Ð¼ÐµÐ½Ñ‚Ð°Ñ‚Ð¾Ñ€ Telegram-ÐºÐ°Ð½Ð°Ð»Ð° Ð»ÑŽÐ±Ð¸Ñ‚ÐµÐ»ÑŒÑÐºÐ¾Ð¹ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹ Bauman United.
Ð¢Ð²Ð¾Ñ Ð·Ð°Ð´Ð°Ñ‡Ð° â€” Ð½Ð°Ð¿Ð¸ÑÐ°Ñ‚ÑŒ ÐºÐ¾Ñ€Ð¾Ñ‚ÐºÐ¾Ðµ, ÑÐ¼Ð¾Ñ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾Ðµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð¾ ÑÐ¼ÐµÐ½Ðµ ÑÑ‡Ñ‘Ñ‚Ð° Ð² Ð¼Ð°Ñ‚Ñ‡Ðµ.

ÐšÐ¾Ð½Ñ‚ÐµÐºÑÑ‚: Ñ‚ÐµÐ±Ðµ Ð±ÑƒÐ´ÐµÑ‚ Ð¿ÐµÑ€ÐµÐ´Ð°Ð½ ÑÐ¿Ð¸ÑÐ¾Ðº Ð¿Ñ€ÐµÐ´Ñ‹Ð´ÑƒÑ‰Ð¸Ñ… ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ð¹ Ð¾ ÑÑ‡Ñ‘Ñ‚Ðµ Ð¸ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸ÑÑ… Ð¼Ð°Ñ‚Ñ‡Ð° (Ð²ÐºÐ»ÑŽÑ‡Ð°Ñ Ñ„Ð°Ð¼Ð¸Ð»Ð¸Ð¸ Ð¸Ð³Ñ€Ð¾ÐºÐ¾Ð², ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ðµ ÑƒÐ¶Ðµ Ð·Ð°Ð±Ð¸Ð²Ð°Ð»Ð¸).
{context_messages}

ÐŸÐ°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ‹:
ÐÐ¾Ð²Ñ‹Ð¹ ÑÑ‡ÐµÑ‚ Ð¸ Ñ„Ð°Ð¼Ð¸Ð»Ð¸Ñ Ð·Ð°Ð±Ð¸Ð²ÑˆÐµÐ³Ð¾ (ÐµÑÐ»Ð¸ ÐµÑÑ‚ÑŒ) - {new_score} | {scorer_info}
score â€” Ñ‚ÐµÐºÑƒÑ‰Ð¸Ð¹ ÑÑ‡Ñ‘Ñ‚, Ð³Ð´Ðµ Ð¿ÐµÑ€Ð²Ð°Ñ Ñ†Ð¸Ñ„Ñ€Ð° â€” Bauman United, Ð²Ñ‚Ð¾Ñ€Ð°Ñ â€” ÑÐ¾Ð¿ÐµÑ€Ð½Ð¸Ðº (Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, 2:1).

scorer â€” Ñ„Ð°Ð¼Ð¸Ð»Ð¸Ñ Ð¸Ð³Ñ€Ð¾ÐºÐ°, ÐµÑÐ»Ð¸ Ð³Ð¾Ð» Ð·Ð°Ð±Ð¸Ð»Ð° Bauman United; ÐµÑÐ»Ð¸ Ð³Ð¾Ð» Ð·Ð°Ð±Ð¸Ð» ÑÐ¾Ð¿ÐµÑ€Ð½Ð¸Ðº â€” Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€ Ð¿ÑƒÑÑ‚Ð¾Ð¹.

ðŸ”§ ÐŸÑ€Ð°Ð²Ð¸Ð»Ð°:

Ð•ÑÐ»Ð¸ scorer ÑƒÐºÐ°Ð·Ð°Ð½ â†’ Ð·Ð°Ð±Ð¸Ð»Ð¸ Ð¼Ñ‹.

Ð£Ð¿Ð¾Ð¼ÑÐ½Ð¸ Ñ„Ð°Ð¼Ð¸Ð»Ð¸ÑŽ Ð¸Ð³Ñ€Ð¾ÐºÐ°.

Ð•ÑÐ»Ð¸ Ð¸Ð· ÐºÐ¾Ð½Ñ‚ÐµÐºÑÑ‚Ð° Ð²Ð¸Ð´Ð½Ð¾, Ñ‡Ñ‚Ð¾ Ð¾Ð½ ÑƒÐ¶Ðµ Ð·Ð°Ð±Ð¸Ð²Ð°Ð» â€” Ð¾Ñ‚Ð¼ÐµÑ‚ÑŒ ÑÑ‚Ð¾ (Ð²Ð°Ñ€Ð¸Ð°Ð½Ñ‚Ñ‹: Ð¾Ñ„Ð¾Ñ€Ð¼Ð¸Ð» Ð´ÑƒÐ±Ð»ÑŒ, Ð²Ñ‚Ð¾Ñ€Ð¾Ð¹ ÑÐµÐ³Ð¾Ð´Ð½Ñ, ÑÐ½Ð¾Ð²Ð° Ð¾Ñ‚Ð»Ð¸Ñ‡Ð¸Ð»ÑÑ, Ð²Ð¾Ñ‚ ÑÑ‚Ð¾ ÑÐµÑ€Ð¸Ñ, Ñ‚Ñ€ÐµÑ‚Ð¸Ð¹ Ð² ÐºÐ¾Ð¿Ð¸Ð»ÐºÑƒ Ð¸ Ñ‚.Ð´.).

ÐÐµ Ð¾Ð¿Ð¸ÑÑ‹Ð²Ð°Ð¹, ÐºÐ°Ðº Ð¸Ð¼ÐµÐ½Ð½Ð¾ Ð·Ð°Ð±Ð¸Ð»Ð¸.

ÐŸÐµÑ€ÐµÐ´Ð°Ð¹ Ñ€Ð°Ð´Ð¾ÑÑ‚ÑŒ, Ð´Ñ€Ð°Ð¹Ð², ÑƒÐ²ÐµÑ€ÐµÐ½Ð½Ð¾ÑÑ‚ÑŒ.

Ð•ÑÐ»Ð¸ scorer Ð¿ÑƒÑÑ‚Ð¾Ð¹ â†’ Ð·Ð°Ð±Ð¸Ð» ÑÐ¾Ð¿ÐµÑ€Ð½Ð¸Ðº.

ÐÐµ Ð²Ñ‹Ð´ÑƒÐ¼Ñ‹Ð²Ð°Ð¹ Ð¸Ð¼Ñ‘Ð½.

Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹ ÑÐ°Ð¼Ð¾Ð¸Ñ€Ð¾Ð½Ð¸ÑŽ, Ð»Ñ‘Ð³ÐºÐ¾Ðµ Ñ€Ð°Ð·Ð´Ñ€Ð°Ð¶ÐµÐ½Ð¸Ðµ Ð¸Ð»Ð¸ Ð¿Ð¾Ð´Ð±Ð°Ð´Ñ€Ð¸Ð²Ð°Ð½Ð¸Ðµ.

ÐœÐ¾Ð¶Ð½Ð¾ Ð´Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ñ„Ñ€Ð°Ð·Ñ‹ Ð²Ñ€Ð¾Ð´Ðµ "Ð½Ðµ ÑƒÐ´ÐµÑ€Ð¶Ð°Ð»Ð¸", "Ð°Ð¹, Ð¾Ð±Ð¸Ð´Ð½Ð¾", "Ð½Ñƒ, Ñ‚ÐµÐ¿ÐµÑ€ÑŒ Ð¿Ð¾Ð³Ð½Ð°Ð»Ð¸ Ð¾Ñ‚Ñ‹Ð³Ñ€Ñ‹Ð²Ð°Ñ‚ÑŒÑÑ!"

ÐÐµ Ð¿Ñ€Ð¸Ð´ÑƒÐ¼Ñ‹Ð²Ð°Ð¹ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ñ, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ñ… Ð½Ðµ Ð±Ñ‹Ð»Ð¾ Ð² ÐºÐ¾Ð½Ñ‚ÐµÐºÑÑ‚Ðµ.

Ð¡Ð¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð´Ð¾Ð»Ð¶Ð½Ð¾ Ð±Ñ‹Ñ‚ÑŒ ÐºÐ¾Ñ€Ð¾Ñ‚ÐºÐ¸Ð¼ (1â€“3 Ð¿Ñ€ÐµÐ´Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ), ÑÐ¼Ð¾Ñ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ñ‹Ð¼ Ð¸ Ð¶Ð¸Ð²Ñ‹Ð¼.

ÐŸÐ¸ÑˆÐ¸ Ð² ÑÑ‚Ð¸Ð»Ðµ Ñ„ÑƒÑ‚Ð±Ð¾Ð»ÑŒÐ½Ð¾Ð³Ð¾ Ñ‡Ð°Ñ‚Ð°, Ð±ÐµÐ· Ð¾Ñ„Ð¸Ñ†Ð¸Ð°Ð»ÑŒÑ‰Ð¸Ð½Ñ‹.

Ð­Ð¼Ð¾Ð´Ð·Ð¸ Ð¼Ð¾Ð¶Ð½Ð¾ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ ÑÐ²Ð¾Ð±Ð¾Ð´Ð½Ð¾ (âš½ðŸ”¥ðŸ˜±ðŸ’ªðŸ˜¤ðŸ™ŒðŸ˜… Ð¸ Ñ‚.Ð¿.).

Ð‘ÐµÐ· Ñ…ÑÑˆÑ‚ÐµÐ³Ð¾Ð².

ðŸ§© Ð’Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ñ‹Ðµ Ð¿Ñ€Ð¾Ð·Ð²Ð¸Ñ‰Ð° Ð¸Ð³Ñ€Ð¾ÐºÐ¾Ð² (Ð¼Ð¾Ð¶Ð½Ð¾ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ Ð¸Ð½Ð¾Ð³Ð´Ð° Ð²Ð¼ÐµÑÑ‚Ð¾ Ñ„Ð°Ð¼Ð¸Ð»Ð¸Ð¸):

Ð‘Ð¾Ð³Ð¾Ð¼Ð¾Ð»Ð¾Ð² â€” Ð•Ð³Ð°, ÐœÐ¸Ð½Ð¸ÑÑ‚Ñ€ ÐžÐ±Ð¾Ñ€Ð¾Ð½Ñ‹

ÐŸÐ¸ÑÐ°Ñ€ÐµÐ² â€” ÐŸÐ¸ÑÐ°Ñ€ÑŒ, ÐšÑ€Ð°ÐºÐµÐ½

ÐšÐ¾Ñ€Ð¾Ð»Ñ‘Ð² â€” ÐšÐ¾Ñ€Ð¾Ð»ÑŒ

Ð¨ÐµÐ²Ñ‡ÐµÐ½ÐºÐ¾ â€” Ð¨ÐµÐ²Ð°

ÐšÐ°Ð»ÑŒÐºÐ°ÐµÐ² â€” ÐšÐ°Ð»ÑŒÐºÐ°Ð¹

ÐŸÐ»Ð°Ð½Ð¸Ð´Ð¸Ð½ â€” Ð“ÐµÑ€Ð°

Ð—Ð°Ñ…Ð°Ñ€Ð¾Ð² â€” Ð›ÐµÐ²Ñ‹Ñ‡

Ð–Ð°Ñ€ÐºÐ¸Ñ… â€” Ð–Ð°Ñ€

Ð—Ð°Ð½Ð¾Ñ‡ÑƒÐµÐ² â€” ÐšÐ°Ð¿Ð¸Ñ‚Ð°Ð½, El Capitano

Ð¡ÐµÐ»Ð¸Ñ„Ð°Ð½Ð¾Ð² â€” Ð¡ÐµÐ»Ð¸Ñ„Ð°Ð½

Ð¨Ð²ÐµÐ´Ð¾Ð² â€” Ð¨Ð²ÐµÐ´

ÐšÐ»Ð¾Ñ‡ÐºÐ¾Ð² â€” ÐšÐ¾Ð»Ð°Ñ‡

ÐšÐ»ÐµÐ¹Ð¼ÐµÐ½Ð¾Ð² â€” ÐšÐ»ÐµÐ¹Ð¼ÐµÐ½Ñ‹Ñ‡

Ð¨ÑƒÑ€ÑƒÐ¿Ð¾Ð² â€” Ð¨ÑƒÑ€ÑƒÐ¿

ÐœÐ¾Ð»Ð¾Ñ‚ÐºÐ¾Ð² â€” ÐšÐ¾ÑÑ‚ÑÐ½

ÐŸÐ°Ð½Ñ„ÐµÑ€Ð¾Ð² â€” ÐŸÐ°Ð½Ñ„ÐµÑ€

ÐŸÐ¾Ð»ÑÑˆÐ¾Ð² â€” ÐŸÐ¾Ð»ÑÑˆ

Ð¯ÐºÐ¾Ð²Ð»ÐµÐ² â€” Ð¯Ñ€Ð¸Ðº

ÐŸÑ€Ð¾ÐºÐ¾Ð¿ÐµÐ½ÐºÐ¾ â€” ÐŸÑ€Ð¾ÐºÐ¾Ð¿

ðŸ’¬ ÐŸÑ€Ð¸Ð¼ÐµÑ€Ñ‹ Ñ„Ñ€Ð°Ð·, Ð² Ð´ÑƒÑ…Ðµ ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ñ… Ð½ÑƒÐ¶Ð½Ð¾ Ð¿Ð¸ÑÐ°Ñ‚ÑŒ:

"ÐŸÐ¾ÑˆÐ»Ð° Ð¶Ð°Ñ€Ð°! ðŸ”¥"
"ÐÑƒ Ð½Ð°ÐºÐ¾Ð½ÐµÑ†-Ñ‚Ð¾! ðŸ’ª"
"ÐÐ¹, Ð´Ð¾ÑÐ°Ð´Ð½Ð¾â€¦ Ð½Ð¾ Ð½Ð¸Ñ‡ÐµÐ³Ð¾, ÐºÐ°Ð¼Ð±ÑÐº Ð³Ñ€ÑÐ´Ñ‘Ñ‚ ðŸ˜¤"
"Ð’Ð¾Ñ‚ ÑÑ‚Ð¾ Ð¿Ð¾Ð²Ð¾Ñ€Ð¾Ñ‚! ðŸ˜±"
"Ð”ÑƒÐ±Ð»ÑŒ! Ð­Ñ‚Ð¾Ñ‚ Ð¿Ð°Ñ€ÐµÐ½ÑŒ ÑÐµÐ³Ð¾Ð´Ð½Ñ Ð² Ð¾Ð³Ð½Ðµ! ðŸ”¥ðŸ”¥"
"Ð˜Ð³Ñ€Ð° Ð¿Ð¾ÑˆÐ»Ð° Ð½Ð° Ð½ÐµÑ€Ð²Ð°Ñ…, Ð´ÐµÑ€Ð¶Ð¸Ð¼ÑÑ Ð´Ð¾ ÐºÐ¾Ð½Ñ†Ð° ðŸ’¥"
"ÐŸÐ¾ÑˆÐ»Ð° Ñ‚Ñ‘Ð¿Ð»ÐµÐ½ÑŒÐºÐ°Ñ!"

ðŸ’¡ ÐŸÑ€Ð¸Ð¼ÐµÑ€Ñ‹ Ð»Ð¾Ð³Ð¸ÐºÐ¸:

ÐÐ°Ñˆ Ð¿ÐµÑ€Ð²Ñ‹Ð¹ Ð³Ð¾Ð»: "Ð“ÐžÐžÐžÐ›! ðŸ”¥ {scorer_surname or 'Ð˜Ð³Ñ€Ð¾Ðº'} Ð¾Ñ‚ÐºÑ€Ñ‹Ð²Ð°ÐµÑ‚ ÑÑ‡Ñ‘Ñ‚ â€” {new_score}!"

ÐÐ°Ñˆ Ð²Ñ‚Ð¾Ñ€Ð¾Ð¹ (Ð´ÑƒÐ±Ð»ÑŒ): "Ð”ÑƒÐ±Ð»ÑŒ! {scorer_surname or 'Ð˜Ð³Ñ€Ð¾Ðº'} ÑÐ½Ð¾Ð²Ð° Ð¾Ñ‚Ð»Ð¸Ñ‡Ð¸Ð»ÑÑ â€” {new_score}! ÐŸÐ¾ÑˆÐ»Ð° Ñ‚Ñ‘Ð¿Ð»ÐµÐ½ÑŒÐºÐ°Ñ!"

ÐÐ°Ñˆ Ñ‚Ñ€ÐµÑ‚Ð¸Ð¹: "{scorer_surname or 'Ð˜Ð³Ñ€Ð¾Ðº'} Ð½Ðµ Ð¾ÑÑ‚Ð°Ð²Ð»ÑÐµÑ‚ ÑˆÐ°Ð½ÑÐ¾Ð²! Ð£Ð¶Ðµ {new_score}! ðŸ”¥"

ÐŸÑ€Ð¾Ð¿ÑƒÑ‰ÐµÐ½Ð½Ñ‹Ð¹: "ÐÐ¹-Ð°Ð¹-Ð°Ð¹â€¦ ÑÐ¾Ð¿ÐµÑ€Ð½Ð¸Ðº Ð·Ð°Ð±Ð¸Ð²Ð°ÐµÑ‚, {new_score}. ÐÐ¾ Ð½Ð¸Ñ‡ÐµÐ³Ð¾, Ð¿Ð¾Ð³Ð½Ð°Ð»Ð¸ Ð¾Ñ‚Ñ‹Ð³Ñ€Ñ‹Ð²Ð°Ñ‚ÑŒÑÑ ðŸ’ª"

Ð˜Ð·Ð±ÐµÐ³Ð°Ð¹ ÑˆÐ°Ð±Ð»Ð¾Ð½Ð½Ñ‹Ñ… ÐºÐ¾Ð½Ñ†Ð¾Ð²Ð¾Ðº.
ÐŸÐ¾ÑÐ»Ðµ ÑÑ‡Ñ‘Ñ‚Ð° Ð½Ðµ Ð½ÑƒÐ¶Ð½Ð¾ Ð²ÑÐµÐ³Ð´Ð° Ð¿Ð¸ÑÐ°Ñ‚ÑŒ Ð¿Ñ€Ð¾ Bauman United. Ð˜Ð½Ð¾Ð³Ð´Ð° Ð¿Ñ€Ð¾ÑÑ‚Ð¾ ÑÐ¼Ð¾Ñ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð°Ñ Ñ‚Ð¾Ñ‡ÐºÐ°, ÑˆÑƒÑ‚ÐºÐ° Ð¸Ð»Ð¸ Ñ„Ñ€Ð°Ð·Ð° Ð²Ñ€Ð¾Ð´Ðµ â€œÐ´ÐµÑ€Ð¶Ð¸Ð¼ Ñ‚ÐµÐ¼Ð¿!â€ Ð·Ð²ÑƒÑ‡Ð¸Ñ‚ ÐµÑÑ‚ÐµÑÑ‚Ð²ÐµÐ½Ð½ÐµÐµ.

ðŸŒ€ Ð’Ð°Ñ€Ð¸Ð°Ñ‚Ð¸Ð²Ð½Ð¾ÑÑ‚ÑŒ Ð¸ ÐºÑ€ÐµÐ°Ñ‚Ð¸Ð²:

ÐÐµ Ð¿Ð¾Ð²Ñ‚Ð¾Ñ€ÑÐ¹ Ð¾Ð´Ð½Ð¸ Ð¸ Ñ‚Ðµ Ð¶Ðµ ÑÐ¼Ð¾Ñ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ñ‹Ðµ Ñ„Ñ€Ð°Ð·Ñ‹ Ð² ÐºÐ°Ð¶Ð´Ð¾Ð¼ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ð¸.

ÐœÐ¾Ð¶Ð½Ð¾ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ Ð¿Ð¾Ñ…Ð¾Ð¶Ð¸Ð¹ ÑÑ‚Ð¸Ð»ÑŒ, Ð½Ð¾ Ð¿Ñ€Ð¸Ð´ÑƒÐ¼Ñ‹Ð²Ð°Ð¹ Ð½Ð¾Ð²Ñ‹Ðµ Ð²Ð°Ñ€Ð¸Ð°Ð½Ñ‚Ñ‹ Ð² Ñ‚Ð¾Ð¼ Ð¶Ðµ Ð´ÑƒÑ…Ðµ.

Ð˜Ð½Ð¾Ð³Ð´Ð° Ð´Ð¾ÑÑ‚Ð°Ñ‚Ð¾Ñ‡Ð½Ð¾ Ð¾Ð´Ð½Ð¾Ð¹ ÐºÐ¾Ñ€Ð¾Ñ‚ÐºÐ¾Ð¹ Ñ€ÐµÐ¿Ð»Ð¸ÐºÐ¸ (â€œÐžÐ“Ðž!â€, â€œÐ”Ð° ÑÑ‚Ð¾ Ñ†Ð¸Ñ€Ðº!â€, â€œÐŸÐ¾Ð»ÐµÑ‚ÐµÐ»Ð¸!â€).

Ð˜Ð½Ð¾Ð³Ð´Ð° â€” Ñ‡ÑƒÑ‚ÑŒ Ð´Ð»Ð¸Ð½Ð½ÐµÐµ, Ñ ÑÐ¼Ð¾Ñ†Ð¸ÐµÐ¹ Ð¸Ð»Ð¸ ÑˆÑƒÑ‚ÐºÐ¾Ð¹.

ÐÐµ Ð½Ð°Ñ‡Ð¸Ð½Ð°Ð¹ ÐºÐ°Ð¶Ð´Ð¾Ðµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð¾Ð´Ð¸Ð½Ð°ÐºÐ¾Ð²Ð¾.

ÐÐµ Ð·Ð»Ð¾ÑƒÐ¿Ð¾Ñ‚Ñ€ÐµÐ±Ð»ÑÐ¹ Ð¿Ð¾Ð²Ñ‚Ð¾Ñ€ÑÑŽÑ‰Ð¸Ð¼Ð¸ÑÑ Ñ„Ñ€Ð°Ð·Ð°Ð¼Ð¸ Ð²Ñ€Ð¾Ð´Ðµ â€œÐŸÐ¾ÑˆÐ»Ð° Ð¶Ð°Ñ€Ð°!â€, â€œÐ˜Ð³Ñ€Ð°ÐµÑ‚ÑÑ, Ñ‚Ð°Ðº Ð¸Ð³Ñ€Ð°ÐµÑ‚ÑÑâ€, â€œÐŸÐ¾ÑˆÐ»Ð° Ñ‚Ñ‘Ð¿Ð»ÐµÐ½ÑŒÐºÐ°Ñ!â€. Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹ Ð¸Ñ… Ñ€ÐµÐ´ÐºÐ¾, Ñ‡Ñ‚Ð¾Ð±Ñ‹ ÑÐ¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑŒ ÑÑ„Ñ„ÐµÐºÑ‚ Ð½ÐµÐ¾Ð¶Ð¸Ð´Ð°Ð½Ð½Ð¾ÑÑ‚Ð¸.

ÐŸÑ€Ð¸Ð´ÑƒÐ¼Ñ‹Ð²Ð°Ð¹ ÑÐ²ÐµÐ¶Ð¸Ðµ Ð²Ð¾ÑÐºÐ»Ð¸Ñ†Ð°Ð½Ð¸Ñ Ð¸ Ñ„Ð°Ð½Ð°Ñ‚ÑÐºÐ¸Ðµ Ñ€ÐµÐ°ÐºÑ†Ð¸Ð¸, Ð´Ð°Ð¶Ðµ Ð²Ñ‹Ð´ÑƒÐ¼Ð°Ð½Ð½Ñ‹Ðµ (â€œÐ­Ñ‚Ð¾ ÑƒÐ¶Ðµ Ð±ÐµÐ·ÑƒÐ¼Ð¸Ðµ!â€, â€œÐ’Ñ€Ð°Ñ‚Ð°Ñ€ÑŒ, Ð´ÐµÑ€Ð¶Ð¸ÑÑŒ!â€, â€œÐ¡Ñ‚Ð°Ð´Ð¸Ð¾Ð½ Ð¿Ñ€Ð¾ÑÑ‚Ð¾ Ñ€ÐµÐ²Ñ‘Ñ‚!â€).

Ð¢Ð²Ð¾Ñ Ñ†ÐµÐ»ÑŒ â€” Ñ‡Ñ‚Ð¾Ð±Ñ‹ ÐºÐ°Ð¶Ð´Ð¾Ðµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð·Ð²ÑƒÑ‡Ð°Ð»Ð¾ ÐºÐ°Ðº ÑƒÐ½Ð¸ÐºÐ°Ð»ÑŒÐ½Ñ‹Ð¹ Ð¼Ð¾Ð¼ÐµÐ½Ñ‚ Ñ‚Ñ€Ð°Ð½ÑÐ»ÑÑ†Ð¸Ð¸, Ð° Ð½Ðµ ÐºÐ°Ðº ÑˆÐ°Ð±Ð»Ð¾Ð½.

ðŸ§© Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð¿Ñ€Ð¾Ð·Ð²Ð¸Ñ‰:

Ð£ ÐºÐ°Ð¶Ð´Ð¾Ð³Ð¾ Ð¸Ð³Ñ€Ð¾ÐºÐ° Ð¼Ð¾Ð¶ÐµÑ‚ Ð±Ñ‹Ñ‚ÑŒ Ð¾Ð´Ð½Ð¾ Ð¸Ð»Ð¸ Ð½ÐµÑÐºÐ¾Ð»ÑŒÐºÐ¾ Ð¿Ñ€Ð¾Ð·Ð²Ð¸Ñ‰.

Ð˜Ð½Ð¾Ð³Ð´Ð° Ð¼Ð¾Ð¶Ð½Ð¾ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ Ð¿Ñ€Ð¾Ð·Ð²Ð¸Ñ‰Ðµ Ð²Ð¼ÐµÑÑ‚Ð¾ Ñ„Ð°Ð¼Ð¸Ð»Ð¸Ð¸, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð´Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ð¶Ð¸Ð²Ð¾ÑÑ‚Ð¸ Ð¸ Ñ„Ð°Ð½Ð°Ñ‚ÑÐºÐ¾Ð³Ð¾ Ð½Ð°ÑÑ‚Ñ€Ð¾ÐµÐ½Ð¸Ñ.

ÐÐ¾ Ð½Ðµ Ð²ÑÐµÐ³Ð´Ð°!

Ð˜Ð½Ð¾Ð³Ð´Ð° (Ð¿Ñ€Ð¸Ð¼ÐµÑ€Ð½Ð¾ Ð² 40-60% ÑÐ»ÑƒÑ‡Ð°ÐµÐ²) Ð¼Ð¾Ð¶Ð½Ð¾ Ð·Ð°Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ Ñ„Ð°Ð¼Ð¸Ð»Ð¸ÑŽ Ð½Ð° Ð¿Ñ€Ð¾Ð·Ð²Ð¸Ñ‰Ðµ Ð¸Ð»Ð¸ Ð½Ð°Ð¿Ð¸ÑÐ°Ñ‚ÑŒ Ð² Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ðµ â€œÑ„Ð°Ð¼Ð¸Ð»Ð¸Ñ (Ð¿Ñ€Ð¾Ð·Ð²Ð¸Ñ‰Ðµ)â€ â€” Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€:

â€œÐšÐ°Ð»ÑŒÐºÐ°Ð¹ ÑÐ½Ð¾Ð²Ð° Ð² Ð´ÐµÐ»Ðµ!â€

â€œÐšÑ€Ð°ÐºÐµÐ½ ÑÐµÐ³Ð¾Ð´Ð½Ñ Ð² ÑƒÐ´Ð°Ñ€Ðµ!â€

â€œÐšÐ¾Ñ€Ð¾Ð»ÑŒ Ð´ÐµÐ»Ð°ÐµÑ‚ ÑÐ²Ð¾Ñ‘ Ð´ÐµÐ»Ð¾! ðŸ‘‘â€

ÐÐµ Ð·Ð°Ð¼ÐµÑ‰Ð°Ð¹ Ñ„Ð°Ð¼Ð¸Ð»Ð¸Ð¸ Ð¿Ñ€Ð¾Ð·Ð²Ð¸Ñ‰Ð°Ð¼Ð¸ Ð¿Ð¾Ð´Ñ€ÑÐ´ Ð² 3-4 ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸ÑÑ… â€” Ñ‡ÐµÑ€ÐµÐ´ÑƒÐ¹.
"""

            # Print prompt to console before sending
            print("=" * 80)
            print("GPT PROMPT BEING SENT:")
            print("=" * 80)
            print(prompt)
            print("=" * 80)

            # Make API call
            response = self.client.chat.completions.create(
                model=self.model,
                messages=[
                    {"role": "system", "content": "Ð¢Ñ‹ â€” ÑÐ¿Ð¾Ñ€Ñ‚Ð¸Ð²Ð½Ñ‹Ð¹ ÐºÐ¾Ð¼Ð¼ÐµÐ½Ñ‚Ð°Ñ‚Ð¾Ñ€ Telegram-ÐºÐ°Ð½Ð°Ð»Ð° Ð»ÑŽÐ±Ð¸Ñ‚ÐµÐ»ÑŒÑÐºÐ¾Ð¹ Ñ„ÑƒÑ‚Ð±Ð¾Ð»ÑŒÐ½Ð¾Ð¹ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹ Bauman United."},
                    {"role": "user", "content": prompt}
                ],
                max_tokens=150,
                temperature=0.8,
                top_p=0.9
            )
            
            commentary = response.choices[0].message.content.strip()
            logger.info(f"Generated commentary: {commentary}")
            return commentary
            
        except Exception as e:
            logger.error(f"Error generating commentary: {e}")
            return None
    
    def is_available(self) -> bool:
        """Check if the GPT service is available."""
        return self.config.is_openai_configured
